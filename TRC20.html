<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Claim TRC20 tokens every 72 hours with our easy-to-use platform. Make sure to have enough energy to claim your tokens.">
    <meta property="og:title" content="TRC20 Token Claimer">
    <meta property="og:description" content="Claim TRC20 tokens every 72 hours with our easy-to-use platform.">
    <meta property="og:image" content="https://github.com/ClaimTRX/Test/blob/main/affiliateProgramEnglish.png?raw=true">
    <meta property="og:url" content="YOUR_URL_HERE">
    <title>TRC20 Token Claimer</title>
    <style>
        body { 
            text-align: center; 
            font-family: Arial, sans-serif; 
            background-color: #f5f5f5; 
            color: #333; 
            padding: 20px; 
        }
        #container {
            background: white; 
            border-radius: 5px; 
            padding: 20px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
            display: inline-block; 
            width: 100%; 
            max-width: 600px; 
        }
        h1, h2 { 
            color: #007bff; 
        }
        p {
            font-size: 16px; 
            margin: 20px auto; 
            max-width: 600px; 
            line-height: 1.6; 
        }
        a { 
            color: #007bff; 
            text-decoration: none; 
        }
        a:hover, a:focus { 
            text-decoration: underline; 
        }
        button, input { 
            width: calc(100% - 22px); 
            margin: 10px 0; 
            padding: 10px; 
            font-size: 16px; 
            background-color: #007bff; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
        }
        button:hover { 
            background-color: #0056b3; 
        }
        .disabled { 
            background-color: #ccc; 
            color: #666; 
            cursor: not-allowed; 
        }
        #tokens { 
            display: none; 
        }
        #logoContainer {
            text-align: center; 
            margin: 20px auto; 
            padding: 20px; 
        }
        #logo {
            max-width: 100%; 
            height: auto; 
            width: auto; 
        }
        @media (max-width: 768px) {
            #logoContainer {
                padding: 10px; 
            }
            #logo {
                max-width: 80%; 
            }
        }
        #whitelistMessage {
            display: none; 
            color: red; 
            font-size: 18px; 
            margin-top: 20px; 
        }
        #cooldownTimer {
            color: red; 
            font-size: 18px; 
            margin-top: 10px; 
        }
        #buttonContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        .dropdown {
            display: flex;
            justify-content: center;
            width: 100%;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        .dropdown:hover .dropbtn {
            background-color: #0056b3;
        }
        .dropbtn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 200px; /* Ensure width matches the Connect Wallet button */
        }
        .dropbtn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1>TRC20 Token Claimer</h1>
        <div id="buttonContainer">
            <div class="dropdown">
                <button class="dropbtn">Menu</button>
                <div class="dropdown-content">
                   <a href="index.html">Home</a>
                    <a href="CFTToken.html">Buy CFT</a>
                    <a href="staking.html">Staking</a>
                     <a href="Marketplace.html">Marketplace</a>
                    <a href="Claim.html">Claim</a>
                    <a href="Draw.html">Draw</a>
                </div>
            </div>
            <button id="connectWallet">Connect Wallet</button>
        </div>
        <p>Claim TRC20 tokens once every 72 hours. Energy is consumed from users addresses, so make sure the claimable amount is worth claiming. Tokens accumulate every minute. Will you claim now or risk someone else claiming before you? If you need Energy, you can <a href="https://tronnrg.com/r/TXgL1i4dF1vEhDYuVsMuo8ovcfdEE6tztA" target="_blank">rent it from TronNRG</a>.</p>
        <p>Make sure to have enough energy and check the transaction before approving. Failure will result in loss of TRX</p>
        <p id="whitelistMessage">Contact <a href="https://t.me/Stian_86">Stian_86 on Telegram</a> to be whitelisted for this page.</p>
        <h2>Need energy? Visit TronNRG</h2>
        <div id="logoContainer">
            <a href="https://tronnrg.com/r/TXgL1i4dF1vEhDYuVsMuo8ovcfdEE6tztA/" target="_blank" rel="noopener noreferrer">
                <img id="logo" src="https://github.com/ClaimTRX/Test/blob/main/affiliateProgramEnglish.png?raw=true" alt="Affiliate Program Logo">
            </a>
        </div>
        <div id="tokens">
            <!-- Dynamic Token Content Will Be Added Here -->
        </div>
        <div id="cooldownTimer"></div>
    </div>
</body>
</html>


    <script src="https://cdn.jsdelivr.net/npm/@tronweb3/tronweb@1.3.3/dist/TronWeb.min.js"></script>
    <script>
        const contractAddress = 'TS8Kpw1Nye5zTP1WWcM8TMzvQNiuyxEuPc';  // Updated contract address
        const abi = [
            {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "contractAddress",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "ratePerMinute",
                        "type": "uint256"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint8",
                        "name": "decimals",
                        "type": "uint8"
                    }
                ],
                "name": "TokenSet",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Claimed",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Deposited",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "Withdrawn",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "contractAddress",
                        "type": "address"
                    }
                ],
                "name": "TokenRemoved",
                "type": "event"
            },
            {
                "inputs": [],
                "name": "COOLDOWN",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    }
                ],
                "name": "accumulateTokens",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    }
                ],
                "name": "claim",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    }
                ],
                "name": "removeWhitelistUser",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "contractAddress",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "depositToken",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "contractAddress",
                        "type": "address"
                    },
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "ratePerMinute",
                        "type": "uint256"
                    }
                ],
                "name": "setToken",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "contractAddress",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "withdrawToken",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    }
                ],
                "name": "getClaimableAmount",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    }
                ],
                "name": "whitelist",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "lastClaim",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "lastAccumulated",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getTokenAddresses",
                "outputs": [
                    {
                        "internalType": "address[]",
                        "name": "",
                        "type": "address[]"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    }
                ],
                "name": "getRemainingCooldown",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "tokenAddress",
                        "type": "address"
                    }
                ],
                "name": "tokens",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "contractAddress",
                        "type": "address"
                    },
                    {
                        "internalType": "string",
                        "name": "name",
                        "type": "string"
                    },
                    {
                        "internalType": "uint256",
                        "name": "ratePerMinute",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint256",
                        "name": "accumulatedTokens",
                        "type": "uint256"
                    },
                    {
                        "internalType": "uint8",
                        "name": "decimals",
                        "type": "uint8"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        let tronWeb;
        let contract;
        let userAddress;
        const COOLDOWN_PERIOD = 72 * 60 * 60 * 1000; // 72 hours in milliseconds

        document.getElementById('connectWallet').addEventListener('click', async () => {
            if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
                tronWeb = window.tronWeb;
                userAddress = tronWeb.defaultAddress.base58;
                document.getElementById('connectWallet').innerText = 'Connected';
                contract = await tronWeb.contract(abi, contractAddress);
                checkWhitelist();
                updateTokenInfo();
                setInterval(updateClaimableAmounts, 5000); // Update every 5 seconds
                setInterval(updateCooldownTimer, 60000); // Update cooldown timer every minute
            } else {
                alert('Please install TronLink wallet.');
            }
        });

        async function checkWhitelist() {
            try {
                const isWhitelisted = await contract.whitelist(userAddress).call();
                if (isWhitelisted) {
                    document.getElementById('whitelistMessage').style.display = 'none';
                    document.getElementById('tokens').style.display = 'block';
                } else {
                    document.getElementById('whitelistMessage').style.display = 'block';
                    document.getElementById('tokens').style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking whitelist:', error);
            }
        }

        async function updateTokenInfo() {
            try {
                const tokenAddresses = await contract.getTokenAddresses().call();
                const tokensDiv = document.getElementById('tokens');
                tokensDiv.innerHTML = ''; // Clear existing content

                for (let i = 0; i < tokenAddresses.length; i++) {
                    const tokenInfo = await contract.tokens(tokenAddresses[i]).call();
                    const tokenName = tokenInfo.name;
                    const tokenHtml = `
                        <div id="tokenContainer${i}">
                            <p id="token${i}Name">${tokenName}</p>
                            <p id="claimableAmount${i}">Claimable Amount: 0</p>
                            <button id="claimToken${i}" onclick="claimToken(${i})">Claim</button>
                        </div>
                    `;
                    tokensDiv.insertAdjacentHTML('beforeend', tokenHtml);
                }

                updateClaimableAmounts();
                updateCooldownTimer(); // Call once initially to set button state
            } catch (error) {
                console.error('Error updating token info:', error);
            }
        }

       function formatNumberWithCommas(number) {
        return number.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    async function updateClaimableAmounts() {
        try {
            const tokenAddresses = await contract.getTokenAddresses().call();

            for (let i = 0; i < tokenAddresses.length; i++) {
                const claimableAmount = await contract.getClaimableAmount(tokenAddresses[i]).call();
                const tokenInfo = await contract.tokens(tokenAddresses[i]).call();
                const decimals = tokenInfo.decimals;
                const accumulatedTokens = (claimableAmount / (10 ** decimals)).toFixed(0); // Show whole number
                const formattedTokens = formatNumberWithCommas(accumulatedTokens.toString());
                document.getElementById(`claimableAmount${i}`).innerText = `Claimable Amount: ${formattedTokens}`;
            }
        } catch (error) {
            console.error('Error updating claimable amounts:', error);
        }
    }



        async function updateCooldownTimer() {
            try {
                const remainingCooldown = await contract.getRemainingCooldown(userAddress).call();

                if (remainingCooldown > 0) {
                    const hours = Math.floor(remainingCooldown / (60 * 60));
                    const minutes = Math.floor((remainingCooldown % (60 * 60)) / 60);
                    const seconds = remainingCooldown % 60;
                    document.getElementById('cooldownTimer').innerText = `Cooldown remaining: ${hours}h ${minutes}m ${seconds}s`;
                    disableButtons(true);
                } else {
                    document.getElementById('cooldownTimer').innerText = '';
                    disableButtons(false);
                }
            } catch (error) {
                console.error('Error updating cooldown timer:', error);
            }
        }

        async function claimToken(tokenIndex) {
            if (!contract) {
                alert('Please connect your wallet first.');
                return;
            }

            try {
                const tokenAddresses = await contract.getTokenAddresses().call();
                const tokenAddress = tokenAddresses[tokenIndex];
                await contract.claim(tokenAddress).send({
                    from: userAddress
                });
                document.getElementById('status').innerText = 'Tokens claimed successfully!';
                updateClaimableAmounts();
                updateCooldownTimer(); // Update cooldown timer after claiming
            } catch (error) {
                console.error(error);
                document.getElementById('status').innerText = 'Error claiming tokens.';
            }
        }

        function disableButtons(disable) {
            const tokenButtons = document.querySelectorAll('[id^=claimToken]');
            tokenButtons.forEach(button => {
                button.disabled = disable;
                if (disable) {
                    button.classList.add('disabled');
                } else {
                    button.classList.remove('disabled');
                }
            });
        }

        // Listen for TokenRemoved event and update the UI accordingly
        tronWeb && tronWeb.on('TokenRemoved', async (event) => {
            const removedTokenAddress = event.contractAddress;
            const tokenAddresses = await contract.getTokenAddresses().call();
            for (let i = 0; i < tokenAddresses.length; i++) {
                if (tokenAddresses[i] === removedTokenAddress) {
                    document.getElementById(`tokenContainer${i}`).remove();
                    break;
                }
            }
            updateClaimableAmounts();
        });
    </script>
</body>
</html>
