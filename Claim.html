<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRXClaimer</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-color: #1a1a2e;
      color: #fff;
      font-family: Arial, sans-serif;
    }

    .sidebar {
      height: 100vh;
      background-color: #162447;
      padding: 15px;
      position: fixed;
      width: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sidebar a {
      color: #fff;
      text-decoration: none;
      display: block;
      padding: 10px 0;
      width: 100%;
      text-align: center;
    }

    .sidebar a:hover {
      background-color: #1f4068;
    }

    .topbar {
      background-color: #162447;
      padding: 10px;
      text-align: right;
      margin-left: 200px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .main-content {
      margin-left: 220px;
      padding: 20px;
    }

    .card {
      background-color: #2c3e50;
      color: white;
      border: none;
      border-radius: 10px;
      margin-bottom: 20px;
      padding: 20px;
    }

    .card-body {
      display: flex;
      flex-direction: column;
    }

    .btn-success {
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.875rem;
      padding: 8px 16px;
      margin-top: 10px;
    }

    .form-control {
      padding: 8px;
      font-size: 0.875rem;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    .form-control[type=number] {
      -moz-appearance: textfield;
    }

    .form-control[type=number]::-webkit-outer-spin-button,
    .form-control[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

  </style>
</head>
<body>
  <div class="sidebar">
    <h2>TRXClaimer</h2>
    <a href="index.html">Home</a>
    <a href="https://twitter.com" target="_blank"><i class="fab fa-twitter"></i></a>
    <a href="https://telegram.org" target="_blank"><i class="fab fa-telegram-plane"></i></a>
  </div>
  <div class="topbar">
    <button id="connect-button" class="btn btn-secondary" onclick="connectWallet()">Connect Wallet</button>
  </div>
  <div class="main-content">
    <h1>Claim TRX</h1>
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Claimable Amount: <span id="claimable-amount">0 TRX</span></h5>
        <input type="text" id="tg-username" class="form-control" placeholder="Enter your Telegram username">
        <input type="number" id="claim-amount" class="form-control" placeholder="Enter claim amount">
        <button id="claim-button" class="btn btn-success">Claim</button>
        <p id="cooldown-warning" style="color: red;"></p>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.min.js"></script>
  <script>
     const contractAddress = 'THhmYkR3CrtkmFJauQ7RV84ezgWCdAJEaD';
    let tronWeb, userAddress, trxClaimerContract;
    const contractAbi = [
  {
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "addToBlacklist",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "removeFromBlacklist",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "blockIP",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "unblockIP",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "tgUsername",
        "type": "string"
      },
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      },
      {
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "claimTRX",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "getClaimableAmount",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "lastClaimTime",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "lastClaimTimeByIP",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "cooldownPeriod",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "_maxMinutes",
        "type": "uint256"
      }
    ],
    "name": "setMaxClaimPeriod",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "_minMinutes",
        "type": "uint256"
      }
    ],
    "name": "setMinClaimPeriod",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "_cooldownHours",
        "type": "uint256"
      }
    ],
    "name": "setCooldownPeriod",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "uint256",
        "name": "_amount",
        "type": "uint256"
      }
    ],
    "name": "withdraw",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "user",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "claimTime",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "timeSinceLastClaim",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "tgUsername",
        "type": "string"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "Claim",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "Blacklisted",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "RemovedFromBlacklist",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "IPBlocked",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "string",
        "name": "userIP",
        "type": "string"
      }
    ],
    "name": "IPUnblocked",
    "type": "event"
  }
]
;
   

    document.addEventListener('DOMContentLoaded', async () => {
      if (await checkTronLinkInstalled()) {
        await initializeTronWeb();
        const userIP = await getUserIP();
        if (await isIPBlocked(userIP)) {
          document.getElementById('claim-button').disabled = true;
          document.getElementById('cooldown-warning').innerText = 'Your IP address is currently blocked.';
        } else {
          await updateClaimableAmount();
          setInterval(updateClaimableAmount, 5000); // Update claimable amount every 5 seconds
        }
      }
    });

    async function checkTronLinkInstalled() {
      return new Promise((resolve) => {
        const interval = setInterval(() => {
          if (window.tronWeb && window.tronWeb.defaultAddress.base58) {
            clearInterval(interval);
            resolve(true);
          }
        }, 1000);
      });
    }

    async function initializeTronWeb() {
      tronWeb = window.tronWeb;
      userAddress = tronWeb.defaultAddress.base58;

      document.getElementById('connect-button').style.display = 'none'; // Hide the button

      console.log('Connected to TronLink.');
      console.log('User Address:', userAddress);

      try {
        trxClaimerContract = await tronWeb.contract(contractAbi, contractAddress);
        setupEventListeners();
      } catch (error) {
        console.error('Error initializing TronWeb:', error);
      }
    }

    async function getUserIP() {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    }

    async function isIPBlocked(userIP) {
      try {
        const isBlocked = await trxClaimerContract.methods.blockedIPs(userIP).call();
        console.log('Is IP blocked:', isBlocked);
        return isBlocked;
      } catch (error) {
        console.error('Error checking IP block status:', error);
        return true;
      }
    }

    async function updateClaimableAmount() {
      try {
        console.log('Fetching claimable amount...');
        const claimableAmount = await trxClaimerContract.methods.getClaimableAmount().call();
        console.log('Raw claimable amount (in sun):', claimableAmount);
        const claimableAmountTRX = tronWeb.fromSun(claimableAmount);
        console.log('Claimable amount (in TRX):', claimableAmountTRX);
        document.getElementById('claimable-amount').innerText = `Claimable Amount: ${claimableAmountTRX} TRX`;

        const claimButton = document.getElementById('claim-button');
        if (claimableAmount == 0) {
          claimButton.disabled = true;
        } else {
          const isInCooldown = await checkCooldown();
          if (isInCooldown) {
            claimButton.disabled = true;
          } else {
            claimButton.disabled = false;
          }
        }
      } catch (error) {
        console.error('Error updating claimable amount:', error);
        document.getElementById('claimable-amount').innerText = 'Error loading claimable amount';
      }
    }

    async function checkCooldown() {
      try {
        console.log('Checking cooldown...');
        const lastClaimTime = await trxClaimerContract.methods.lastClaimTime(userAddress).call();
        console.log('Last claim time:', lastClaimTime);
        const cooldownPeriod = await trxClaimerContract.methods.cooldownPeriod().call();
        console.log('Cooldown period:', cooldownPeriod);
        const currentTime = Math.floor(Date.now() / 1000);
        const timeLeft = lastClaimTime + cooldownPeriod - currentTime;

        if (timeLeft > 0) {
          document.getElementById('cooldown-warning').innerText = 'You are currently on a 48-hour cooldown.';
          return true;
        } else {
          document.getElementById('cooldown-warning').innerText = '';
          return false;
        }
      } catch (error) {
        console.error('Error checking cooldown:', error);
        document.getElementById('cooldown-warning').innerText = 'Error checking cooldown period';
        return true;
      }
    }

    function setupEventListeners() {
      document.getElementById('claim-button').addEventListener('click', async () => {
        const tgUsername = document.getElementById('tg-username').value;
        const claimAmount = document.getElementById('claim-amount').value;
        const userIP = await getUserIP();
        if (tgUsername && claimAmount) {
          try {
            await claimTRX(tgUsername, claimAmount, userIP);
          } catch (error) {
            console.error('Error claiming TRX:', error);
          }
        } else {
          alert('Please enter your Telegram username and the claim amount.');
        }
      });
    }

    async function claimTRX(tgUsername, claimAmount, userIP) {
      try {
        const claimableAmount = await trxClaimerContract.methods.getClaimableAmount().call();
        if (parseInt(claimAmount) === parseInt(tronWeb.fromSun(claimableAmount))) {
          await trxClaimerContract.methods.claimTRX(tgUsername, tronWeb.toSun(claimAmount), userIP).send({
            from: userAddress
          });
          alert('TRX claimed successfully!');
          await updateClaimableAmount();
        } else {
          alert('Invalid claim amount. Please enter the correct claimable amount.');
        }
      } catch (error) {
        console.error('Error claiming TRX:', error);
      }
    }

    async function connectWallet() {
      if (await checkTronLinkInstalled()) {
        await initializeTronWeb();
      } else {
        console.log('Please install TronLink extension in your browser.');
      }
    }
  </script>
</body>
</html>



